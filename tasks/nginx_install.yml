---
- name: checking the device name
  ansible.builtin.command: hostname
  register: hostname
- name: print the device name
  debug:
    msg: " nginx installing on {{ hostname}}"
  ignore_errors: true
- name: checking the memory size of target machine
  shell: free -h | awk 'NR == 2 {gsub(/[^0-9]/, "", $7); print $7}'
  register: memory_size
- name: print the memory size of target machine
  debug:
    msg: " Available free memory on {{ hostname }} is {{ memory_size }}"

- name: starting installting nginx services on endpoint
  package:
    name: nginx
    state: latest
  register: installed
  when: memory_size | int > 650

- name: print the status on machine
  debug:
    msg: " nginx service installed on {{ hostname}} successfully "
  when: installed.stat.exists

- name: print the status on machine
  debug:
    msg: " nginx service not install on {{ hostname}} due to insufficient storage"
  when: not installed.stat.exists

